!function(a,b){"use strict";"function"==typeof define&&define.amd?define([],b):"object"==typeof exports?module.exports=b():a.DeepDiff=b()}(this,function(a){"use strict";function b(a,b){a.super_=b,a.prototype=Object.create(b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}})}function c(a,b){Object.defineProperty(this,"kind",{value:a,enumerable:!0}),b&&b.length&&Object.defineProperty(this,"path",{value:b,enumerable:!0})}function d(a,b,c){d.super_.call(this,"E",a),Object.defineProperty(this,"lhs",{value:b,enumerable:!0}),Object.defineProperty(this,"rhs",{value:c,enumerable:!0})}function e(a,b){e.super_.call(this,"N",a),Object.defineProperty(this,"rhs",{value:b,enumerable:!0})}function f(a,b){f.super_.call(this,"D",a),Object.defineProperty(this,"lhs",{value:b,enumerable:!0})}function g(a,b,c){g.super_.call(this,"A",a),Object.defineProperty(this,"index",{value:b,enumerable:!0}),Object.defineProperty(this,"item",{value:c,enumerable:!0})}function h(a,b,c){var d=a.slice((c||b)+1||a.length);return a.length=b<0?a.length+b:b,a.push.apply(a,d),a}function i(a){var b=typeof a;return"object"!==b?b:a===Math?"math":null===a?"null":Array.isArray(a)?"array":a instanceof Date?"date":/^\/.*\//.test(a.toString())?"regexp":"object"}function j(b,c,k,l,m,n,o){m=m||[];var p=m.slice(0);if("undefined"!=typeof n){if(l&&l(p,n,{lhs:b,rhs:c}))return;p.push(n)}var q=typeof b,r=typeof c;if("undefined"===q)"undefined"!==r&&k(new e(p,c));else if("undefined"===r)k(new f(p,b));else if(i(b)!==i(c))k(new d(p,b,c));else if(b instanceof Date&&c instanceof Date&&b-c!==0)k(new d(p,b,c));else if("object"===q&&null!==b&&null!==c){if(o=o||[],o.indexOf(b)<0){if(o.push(b),Array.isArray(b)){var s;b.length;for(s=0;s<b.length;s++)s>=c.length?k(new g(p,s,new f(a,b[s]))):j(b[s],c[s],k,l,p,s,o);for(;s<c.length;)k(new g(p,s,new e(a,c[s++])))}else{var t=Object.keys(b),u=Object.keys(c);t.forEach(function(d,e){var f=u.indexOf(d);f>=0?(j(b[d],c[d],k,l,p,d,o),u=h(u,f)):j(b[d],a,k,l,p,d,o)}),u.forEach(function(b){j(a,c[b],k,l,p,b,o)})}o.length=o.length-1}}else b!==c&&("number"===q&&isNaN(b)&&isNaN(c)||k(new d(p,b,c)))}function k(b,c,d,e){return e=e||[],j(b,c,function(a){a&&e.push(a)},d),e.length?e:a}function l(a,b,c){if(c.path&&c.path.length){var d,e=a[b],f=c.path.length-1;for(d=0;d<f;d++)e=e[c.path[d]];switch(c.kind){case"A":l(e[c.path[d]],c.index,c.item);break;case"D":delete e[c.path[d]];break;case"E":case"N":e[c.path[d]]=c.rhs}}else switch(c.kind){case"A":l(a[b],c.index,c.item);break;case"D":a=h(a,b);break;case"E":case"N":a[b]=c.rhs}return a}function m(a,b,c){if(a&&b&&c&&c.kind){for(var d=a,e=-1,f=c.path?c.path.length-1:0;++e<f;)"undefined"==typeof d[c.path[e]]&&(d[c.path[e]]="number"==typeof c.path[e]?[]:{}),d=d[c.path[e]];switch(c.kind){case"A":l(c.path?d[c.path[e]]:d,c.index,c.item);break;case"D":delete d[c.path[e]];break;case"E":case"N":d[c.path[e]]=c.rhs}}}function n(a,b,c){if(c.path&&c.path.length){var d,e=a[b],f=c.path.length-1;for(d=0;d<f;d++)e=e[c.path[d]];switch(c.kind){case"A":n(e[c.path[d]],c.index,c.item);break;case"D":e[c.path[d]]=c.lhs;break;case"E":e[c.path[d]]=c.lhs;break;case"N":delete e[c.path[d]]}}else switch(c.kind){case"A":n(a[b],c.index,c.item);break;case"D":a[b]=c.lhs;break;case"E":a[b]=c.lhs;break;case"N":a=h(a,b)}return a}function o(a,b,c){if(a&&b&&c&&c.kind){var d,e,f=a;for(e=c.path.length-1,d=0;d<e;d++)"undefined"==typeof f[c.path[d]]&&(f[c.path[d]]={}),f=f[c.path[d]];switch(c.kind){case"A":n(f[c.path[d]],c.index,c.item);break;case"D":f[c.path[d]]=c.lhs;break;case"E":f[c.path[d]]=c.lhs;break;case"N":delete f[c.path[d]]}}}function p(a,b,c){if(a&&b){var d=function(d){c&&!c(a,b,d)||m(a,b,d)};j(a,b,d)}}var q,r,s=[];return q="object"==typeof global&&global?global:"undefined"!=typeof window?window:{},r=q.DeepDiff,r&&s.push(function(){"undefined"!=typeof r&&q.DeepDiff===k&&(q.DeepDiff=r,r=a)}),b(d,c),b(e,c),b(f,c),b(g,c),Object.defineProperties(k,{diff:{value:k,enumerable:!0},observableDiff:{value:j,enumerable:!0},applyDiff:{value:p,enumerable:!0},applyChange:{value:m,enumerable:!0},revertChange:{value:o,enumerable:!0},isConflict:{value:function(){return"undefined"!=typeof r},enumerable:!0},noConflict:{value:function(){return s&&(s.forEach(function(a){a()}),s=null),k},enumerable:!0}}),k}),Backbone.Validation=function(a){"use strict";var b={forceUpdate:!1,selector:"name",labelFormatter:"sentenceCase",valid:Function.prototype,invalid:Function.prototype},c={formatLabel:function(a,c){return i[b.labelFormatter](a,c)},format:function(){var a=Array.prototype.slice.call(arguments),b=a.shift();return b.replace(/\{(\d+)\}/g,function(b,c){return"undefined"!=typeof a[c]?a[c]:b})}},d=function(b,c,e){return c=c||{},e=e||"",a.each(b,function(f,g){b.hasOwnProperty(g)&&(f&&a.isArray(f)?a.forEach(f,function(a,b){d(a,c,e+g+"."+b+"."),c[e+g+"."+b]=a}):f&&"object"==typeof f&&f.constructor===Object&&d(f,c,e+g+"."),c[e+g]=f)}),c},e=function(){var e=function(b,c){return c=c||a.keys(a.result(b,"validation")||{}),a.reduce(c,function(a,b){return a[b]=void 0,a},{})},g=function(b,c){var d=b.attributes;if(a.isFunction(d)?d=d(c):a.isString(d)&&a.isFunction(j[d])&&(d=j[d](c)),a.isArray(d))return d},h=function(b,c){var d=b.validation?a.result(b,"validation")[c]||{}:{};return(a.isFunction(d)||a.isString(d))&&(d={fn:d}),a.isArray(d)||(d=[d]),a.reduce(d,function(b,c){return a.each(a.without(a.keys(c),"msg"),function(a){b.push({fn:k[a],val:c[a],msg:c.msg})}),b},[])},i=function(b,d,e,f){return a.reduce(h(b,d),function(g,h){var i=a.extend({},c,k),j=h.fn.call(i,e,d,h.val,b,f);return j!==!1&&g!==!1&&(j&&!g?a.result(h,"msg")||j:g)},"")},l=function(b,c,d){var e,f={},g=!0,h=a.clone(c);return a.each(d,function(a,c){e=i(b,c,a,h),e&&(f[c]=e,g=!1)}),{invalidAttrs:f,isValid:g}},m=function(b,c){return{preValidate:function(b,c){var d,e=this,f={};return a.isObject(b)?(a.each(b,function(a,b){d=e.preValidate(b,a),d&&(f[b]=d)}),a.isEmpty(f)?void 0:f):i(this,b,c,a.extend({},this.attributes))},isValid:function(e){var f,h,j,k;return e=e||g(c,b),a.isString(e)?h=[e]:a.isArray(e)&&(h=e),h&&(f=d(this.attributes),a.each(this.associatedViews,function(b){a.each(h,function(d){j=i(this,d,f[d],a.extend({},this.attributes)),j?(c.invalid(b,d,j,c.selector),k=k||{},k[d]=j):c.valid(b,d,c.selector)},this)},this)),e===!0&&(k=this.validate()),k&&this.trigger("invalid",this,k,{validationError:k}),h?!k:!this.validation||this._isValid},validate:function(f,h){var i=this,j=!f,k=a.extend({},c,h),m=e(i,g(c,b)),n=a.extend({},m,i.attributes,f),o=d(n),p=f?d(f):o,q=l(i,n,a.pick(o,a.keys(m)));if(i._isValid=q.isValid,a.each(i.associatedViews,function(b){a.each(m,function(a,c){var d=q.invalidAttrs.hasOwnProperty(c),e=p.hasOwnProperty(c);d||k.valid(b,c,k.selector),d&&(e||j)&&k.invalid(b,c,q.invalidAttrs[c],k.selector)})}),a.defer(function(){i.trigger("validated",i._isValid,i,q.invalidAttrs),i.trigger("validated:"+(i._isValid?"valid":"invalid"),i,q.invalidAttrs)}),!k.forceUpdate&&a.intersection(a.keys(q.invalidAttrs),a.keys(p)).length>0)return q.invalidAttrs}}},n=function(b,c,d){c.associatedViews?c.associatedViews.push(b):c.associatedViews=[b],a.extend(c,m(b,d))},o=function(b,c){c&&b.associatedViews.length>1?b.associatedViews=a.without(b.associatedViews,c):(delete b.validate,delete b.preValidate,delete b.isValid,delete b.associatedViews)},p=function(a){n(this.view,a,this.options)},q=function(a){o(a)};return{version:"0.11.3",configure:function(c){a.extend(b,c)},bind:function(c,d){d=a.extend({},b,f,d);var e=d.model||c.model,g=d.collection||c.collection;if("undefined"==typeof e&&"undefined"==typeof g)throw"Before you execute the binding your view must have a model or a collection.\nSee http://thedersen.com/projects/backbone-validation/#using-form-model-validation for more information.";e?n(c,e,d):g&&(g.each(function(a){n(c,a,d)}),g.bind("add",p,{view:c,options:d}),g.bind("remove",q))},unbind:function(b,c){c=a.extend({},c);var d=c.model||b.model,e=c.collection||b.collection;d?o(d,b):e&&(e.each(function(a){o(a,b)}),e.unbind("add",p),e.unbind("remove",q))},mixin:m(null,b)}}(),f=e.callbacks={valid:function(a,b,c){a.$("["+c+'~="'+b+'"]').removeClass("invalid").removeAttr("data-error")},invalid:function(a,b,c,d){a.$("["+d+'~="'+b+'"]').addClass("invalid").attr("data-error",c)}},g=e.patterns={digits:/^\d+$/,number:/^-?(?:\d+|\d{1,3}(?:,\d{3})+)(?:\.\d+)?$/,email:/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))$/i,url:/^(https?|ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i},h=e.messages={required:"{0} is required",acceptance:"{0} must be accepted",min:"{0} must be greater than or equal to {1}",max:"{0} must be less than or equal to {1}",range:"{0} must be between {1} and {2}",length:"{0} must be {1} characters",minLength:"{0} must be at least {1} characters",maxLength:"{0} must be at most {1} characters",rangeLength:"{0} must be between {1} and {2} characters",oneOf:"{0} must be one of: {1}",equalTo:"{0} must be the same as {1}",digits:"{0} must only contain digits",number:"{0} must be a number",email:"{0} must be a valid email",url:"{0} must be a valid url",inlinePattern:"{0} is invalid"},i=e.labelFormatters={none:function(a){return a},sentenceCase:function(a){return a.replace(/(?:^\w|[A-Z]|\b\w)/g,function(a,b){return 0===b?a.toUpperCase():" "+a.toLowerCase()}).replace(/_/g," ")},label:function(a,b){return b.labels&&b.labels[a]||i.sentenceCase(a,b)}},j=e.attributeLoaders={inputNames:function(a){var b=[];return a&&a.$("form [name]").each(function(){/^(?:input|select|textarea)$/i.test(this.nodeName)&&this.name&&"submit"!==this.type&&b.indexOf(this.name)===-1&&b.push(this.name)}),b}},k=e.validators=function(){var b=String.prototype.trim?function(a){return null===a?"":String.prototype.trim.call(a)}:function(a){var b=/^\s+/,c=/\s+$/;return null===a?"":a.toString().replace(b,"").replace(c,"")},c=function(b){return a.isNumber(b)||a.isString(b)&&b.match(g.number)},d=function(c){return!(a.isNull(c)||a.isUndefined(c)||a.isString(c)&&""===b(c)||a.isArray(c)&&a.isEmpty(c))};return{fn:function(b,c,d,e,f){return a.isString(d)&&(d=e[d]),d.call(e,b,c,f)},required:function(b,c,e,f,g){var i=a.isFunction(e)?e.call(f,b,c,g):e;return!(!i&&!d(b))&&(i&&!d(b)?this.format(h.required,this.formatLabel(c,f)):void 0)},acceptance:function(b,c,d,e){if("true"!==b&&(!a.isBoolean(b)||b===!1))return this.format(h.acceptance,this.formatLabel(c,e))},min:function(a,b,d,e){if(!c(a)||a<d)return this.format(h.min,this.formatLabel(b,e),d)},max:function(a,b,d,e){if(!c(a)||a>d)return this.format(h.max,this.formatLabel(b,e),d)},range:function(a,b,d,e){if(!c(a)||a<d[0]||a>d[1])return this.format(h.range,this.formatLabel(b,e),d[0],d[1])},length:function(b,c,d,e){if(!a.isString(b)||b.length!==d)return this.format(h.length,this.formatLabel(c,e),d)},minLength:function(b,c,d,e){if(!a.isString(b)||b.length<d)return this.format(h.minLength,this.formatLabel(c,e),d)},maxLength:function(b,c,d,e){if(!a.isString(b)||b.length>d)return this.format(h.maxLength,this.formatLabel(c,e),d)},rangeLength:function(b,c,d,e){if(!a.isString(b)||b.length<d[0]||b.length>d[1])return this.format(h.rangeLength,this.formatLabel(c,e),d[0],d[1])},oneOf:function(b,c,d,e){if(!a.include(d,b))return this.format(h.oneOf,this.formatLabel(c,e),d.join(", "))},equalTo:function(a,b,c,d,e){if(a!==e[c])return this.format(h.equalTo,this.formatLabel(b,d),this.formatLabel(c,d))},pattern:function(a,b,c,e){if(!d(a)||!a.toString().match(g[c]||c))return this.format(h[c]||h.inlinePattern,this.formatLabel(b,e),c)}}}();return a.each(k,function(b,d){k[d]=a.bind(k[d],a.extend({},c,k))}),e}(_),Backbone.form={},Backbone.form.mixin={},function(){"use strict";var a={},b={};Backbone.form.validModelForm=function(a,b){if(_.isUndefined(a))throw new TypeError("model is undefined");if(_.isUndefined(b))throw new TypeError("form is undefined");if(!(a instanceof Backbone.Model))throw new TypeError("expected Backbone.Model");if(b instanceof HTMLElement||!_.isFunction(b.get)||(b=b.get(0)),!(b instanceof HTMLElement))throw new TypeError("expected HTMLElement");return{model:a,form:b}},Backbone.form.getFormToModelDefaults=function(){return a},Backbone.form.setFormToModelDefaults=function(b){a=_.defaults(b||{},{naming:Backbone.form.FormHelper.MODES.brackets,separator:null,auto:!1,keepPrefix:!0})},Backbone.form.getModelToFormDefaults=function(){return b},Backbone.form.setModelToFormDefaults=function(a){b=_.defaults(a||{},{naming:Backbone.form.FormHelper.MODES.brackets,separator:null,auto:!1,prefix:null})}}(),function(){"use strict";function a(a){if(!(a instanceof this.getRelatedClass()))throw new TypeError("Unexpected related object")}var b={};b.getRelated=function(){return this._related},b.isRelatedWith=function(a){return _.contains(this._related,a)},b.addRelated=function(b){a.call(this,b),this.isRelatedWith(b)||(this._related.push(b),b.isRelatedWith(this)||b.addRelated(this))},b.removeRelated=function(b){a.call(this,b),this.isRelatedWith(b)&&(this._related=_.reject(this._related,function(a){return b===a}),b.isRelatedWith(this)&&b.removeRelated(this))},Backbone.form.mixin.related=b}(),function(){"use strict";var a={};a.silentRelated=function(a){var b,c=this.getRelated();if("boolean"!=typeof a)throw new TypeError("silent must be boolean");for(b=0;b<c.length;++b)c[b]._silent=a},Backbone.form.mixin.relatedSilent=a}(),function(){"use strict";function a(b,c,d){var e,f=!1;if(!(b instanceof HTMLElement))throw new TypeError("Expected HTMLElement");if(_.isUndefined(c))throw new TypeError("Expected mode");for(e in a.MODES)if(a.MODES.hasOwnProperty(e)&&c===a.MODES[e]){f=!0;break}if(!f)throw new TypeError("Unexpected mode");if(c===a.MODES.separator){if("string"!=typeof d)throw new TypeError("separator is not string");if(!d.length)throw new TypeError("separator is empty")}this.form=$(b),this.mode=c,this.separator=d}function b(a){return"[]"===a.substr(a.length-2)}function c(a){if(!_.isString(a))throw new TypeError("Name must be string");var b=this.form.find('[name="'+a+'"]'),c=b.eq(0),d=null,e=null,f=!1;return c.length&&(d=c.attr("type"),e=c.prop("tagName").toLowerCase(),f=c.is(":disabled")),{getControls:function(){return b},getControl:function(){return c},getType:function(){return d},getTagName:function(){return e},isDisabled:function(){return f}}}a.MODES={brackets:"brackets",separator:"separator"},Object.freeze&&Object.freeze(a.MODES),a.prototype.getInputCheckedValue=function(a){var b,c=[];if("string"==typeof a)b=this.form.find('[name="'+a+'"]:enabled');else{if(!_.isFunction(a.each))throw new Error("Unexpected value");b=a}return b.each(function(){var a=$(this);a.is(":checked")&&c.push(a.val())}),c},a.prototype.getControlValue=function(a){var b,d,e=c.call(this,a),f=e.getType();if(!e.isDisabled())switch(e.getTagName()){case"input":"radio"===f?(d=this.getInputCheckedValue(e.getControls()),b=d.length?d[d.length-1]:null):"checkbox"===f?(d=this.getInputCheckedValue(e.getControls()),b=1===d.length&&1===e.getControls().length?d[0]:d.length?d:null):"file"===f?(b=[],e.getControls().each(function(){var a,c,d=$(this),e=[];if(_.isUndefined(FileList))e.push(d.val());else for(c=d.get(0).files,a=0;a<c.length;++a)e.push(c[a].name);b.push({element:d.get(0),filename:e,files:c})})):b="button"!==f&&"submit"!==f&&"image"!==f&&"reset"!==f?e.getControl().val():null;break;case"select":var g=e.getControl().val();b=g&&g.length?g:null;break;case"textarea":b=e.getControl().val();break;case"button":b=null}return b},a.prototype.setControlValue=function(a,b){var d=c.call(this,a),e=d.getType();if(_.isObject(b)&&!_.isArray(b)||_.isFunction(b)||_.isUndefined(b))throw new TypeError("Unexpected value with name "+a);switch(!_.isBoolean(b)||"input"===d.getTagName()&&"checkbox"===e&&1===d.getControls().length||(b=""),d.getTagName()){case"input":"radio"===e?d.getControls().val(_.isArray(b)?b.length?[b[0]]:[]:[b]):"checkbox"===e?_.isBoolean(b)?d.getControl().prop("checked",b):d.getControls().val(_.isArray(b)?b:[b]):"button"!==e&&"submit"!==e&&"image"!==e&&"file"!==e&&"reset"!==e&&d.getControl().val(_.isArray(b)?b.length?b[0]:"":b);break;case"select":d.getControls().val(_.isArray(b)?b:[b]);break;case"textarea":d.getControl().val(_.isArray(b)?b.length?b[0]:"":b)}},a.prototype.getPrefix=function(c){var d=null,e=null;switch(b(c)&&(c=c.substr(0,c.length-2)),this.mode){case a.MODES.brackets:e=c.indexOf("["),e>0&&(d=c.substr(0,e));break;case a.MODES.separator:var f=c.split(this.separator,2);f.length>1&&(d=f[0])}return d},a.prototype.removePrefix=function(b){var c=this.getPrefix(b),d=b;return null!==c&&(d=b.substr(this.mode===a.MODES.separator?c.length+this.separator.length:c.length)),d},a.prototype.removeExtremeBrackets=function(a){return 0===a.indexOf("[")&&a.indexOf("]")===a.length-1?a.substr(1,a.length-2):a},a.prototype.getObjectFromName=function(c,d){var e,f={},g=this.getPrefix(c),h=f,i=null,j=null;if("string"!=typeof c)throw new TypeError("name is not string");if("boolean"!=typeof d)throw new TypeError("keepPrefix is not boolean");switch(e=this.getControlValue(c),b(c)&&(c=c.substr(0,c.length-2)),this.mode){case a.MODES.brackets:var k,l=/\[(.*?)\]/g;if(null!==g){for(d&&(h[g]={},h=h[g]);k=l.exec(c);)i=h,j=k[1],h[k[1]]={},h=h[k[1]];null!==i&&null!==j&&(i[j]=e)}else h[c]=e;break;case a.MODES.separator:c.split(this.separator).forEach(function(a,b,c){(d||!d&&0!==b||1===c.length)&&(i=h,j=a,h[a]={},h=h[a])}),null!==i&&null!==j&&(i[j]=e)}return f},a.prototype.getObjectPath=function(a){for(var b=[],c=_.keys(a),d=a;1===c.length&&_.isObject(d)&&!_.isArray(d);)d=d[c[0]],b.push(c[0]),c=_.keys(d);return _.isObject(d)&&!_.isArray(d)?[]:b},a.prototype.createName=function(b,c,d){var e,f;if(!_.isArray(b))throw new TypeError("Path must be Array");if(0===b.length)throw new Error("Path is empty!");if(!_.isUndefined(c)&&!_.isNull(c)){if("string"!=typeof c)throw new TypeError("Prefix must be string");if(0===c.length)throw new Error("Prefix must be longer than 0 characters")}switch(this.mode){case a.MODES.brackets:for(c?e=c+"["+b[0]+"]":b.length>0&&(e=b[0]),f=1;f<b.length;++f)e+="["+b[f]+"]";break;case a.MODES.separator:for(e=c?c+this.separator:"",f=0;f<b.length;++f)e+=b[f]+this.separator;e=e.substr(0,e.length-this.separator.length)}return d&&(e+="[]"),e},Backbone.form.FormHelper=a}(),function(){"use strict";function a(a,b,c){var d=Backbone.form.validModelForm(a,b);_.extend(this,Backbone.Events),delete this.bind,delete this.unbind,_.extend(this,Backbone.form.mixin.related),_.extend(this,Backbone.form.mixin.relatedSilent),this._related=[],this._auto=!1,this._silent=!1,this._toSynchronize={},this.model=d.model,this.form=d.form,this.options=_.defaults(c||{},Backbone.form.getFormToModelDefaults()),this.formHelper=new Backbone.form.FormHelper(this.form,this.options.naming,this.options.separator),this.$form=$(this.form),this.fileModel=null,this.auto(this.options.auto)}function b(a,c){var d;for(d in c)c.hasOwnProperty(d)&&(a[d]&&_.isObject(c[d])&&!_.isArray(c[d])?b(a[d],c[d]):null!==c[d]?a[d]=c[d]:a[d]&&null===c[d]&&delete a[d]);return a}function c(a){this._silent||a.currentTarget===this.getForm()||this.bindControl(a.currentTarget.getAttribute("name"))}function d(a){var b=this.formHelper.getObjectPath(a),c=!1;if(1===b.length)this.model.unset(b[0],{silent:!0}),c=!0;else if(b.length>1){var d,e,f,g=!0,h=b.length-1;if(d=this.model.get(b[0]),_.isObject(d)&&!_.isArray(d)){for(f=1;f<h&&g;)e=d,d=d[b[f]],_.isObject(d)&&!_.isArray(d)||(g=!1),++f;g&&(delete d[b[b.length-1]],e&&0===_.keys(d).length&&b.length-2>-1&&delete e[b[b.length-2]],0===_.keys(this.model.get(b[0])).length&&this.model.unset(b[0],{silent:!0}),c=!0)}}return c}function e(a,c,d,e){_.isNull(d)?a.unset(c):_.isObject(e)&&!_.isArray(e)&&_.isObject(d)&&!_.isArray(d)?a.set(c,b($.extend(!0,{},e),d)):_.isUndefined(e)&&_.isObject(d)&&!_.isArray(d)?a.set(c,b({},d)):a.set(c,d)}var f={selectable:'select, input[type="checkbox"], input[type="radio"]',inputable:'textarea, input:not([type="radio"],[type="checkbox"],[type="button"],[type="submit"],[type="image"],[type="reset"],[type="file"])'};Object.freeze&&Object.freeze(f),a.prototype.WildcardValueError=function(a){this.name="Backbone.form.FormToModel.WildcardValueError",this.message=a},a.prototype.WildcardValueError.prototype=new Error,a.prototype.bind=function(){var a,b=this.$form.find("[name]:enabled");for(this.trigger("bind:before",b),this.sync(),a=0;a<b.length;a++)this.bindControl(b.get(a).getAttribute("name"));this.trigger("bind:after",b)},a.prototype.bindControl=function(a){var b,c,d=this.formHelper.getObjectFromName(a,this.options.keepPrefix),f=_.keys(d),g=!0,h=this.$form.find('[name="'+a+'"]'),i=h.eq(0);if(f.length>1)throw new this.WildcardValueError('Control "'+a+'" has '+f.length+" values");if(f.length&&(b=f[0],void 0!==d[b])){this.trigger("bind:control:before",a,d),this.silentRelated(!0);try{"file"!==i.attr("type")?(c=this.model.get(b),e(this.model,b,d[b],c)):this.fileModel instanceof Backbone.Model&&(c=this.fileModel.get(b),e(this.fileModel,b,d[b],c),this.fileModel.trigger("change",this.fileModel,{}))}catch(j){throw this.silentRelated(!1),j}this.silentRelated(!1),g=!1,this._toSynchronize[a]={value:d,length:h.length},this.trigger("bind:control:after",a,d,c)}g&&this.trigger("bind:control:fail",a,d)},a.prototype.getModel=function(){return this.model},a.prototype.getForm=function(){return this.form},a.prototype.auto=function(a){if("boolean"!=typeof a)throw new TypeError("Auto must be boolean");a&&!this._auto?(this.$form.on("change",f.selectable,$.proxy(c,this)),this.$form.on("change",'input[type="file"]',$.proxy(c,this)),this.$form.on("change keyup paste input",f.inputable,$.proxy(c,this))):!a&&this._auto&&(this.$form.off("change",f.selectable,c),this.$form.off("change",'input[type="file"]',c),this.$form.off("change keyup paste input",f.inputable,c)),this._auto=a},a.prototype.isAuto=function(){return this._auto},a.prototype.sync=function(){var a,b,c,e=[];this.trigger("sync:before",this._toSynchronize);for(a in this._toSynchronize)this._toSynchronize.hasOwnProperty(a)&&(b=this.$form.find('[name="'+a+'"]'),0===b.length||b.is(":disabled")?d.call(this,this._toSynchronize[a].value)&&e.push(a):b.length!==this._toSynchronize[a].length&&this.bindControl(a));for(c=0;c<e.length;++c)delete this._toSynchronize[e[c]];this.trigger("sync:after",this._toSynchronize)},a.prototype.getRelatedClass=function(){return Backbone.form.ModelToForm},a.prototype.getFileModel=function(){return this.fileModel},a.prototype.setFileModel=function(a){if(!(a instanceof Backbone.Model))throw new TypeError("expected Backbone.Model");this.fileModel=a},Backbone.form.FormToModel=a}(),function(){"use strict";function a(a,b,c){var d=Backbone.form.validModelForm(a,b);_.extend(this,Backbone.Events),delete this.bind,delete this.unbind,_.extend(this,Backbone.form.mixin.related),_.extend(this,Backbone.form.mixin.relatedSilent),this._related=[],this._auto=!1,this._silent=!1,this.model=d.model,this.form=d.form,this.options=_.defaults(c||{},Backbone.form.getModelToFormDefaults()),this.formHelper=new Backbone.form.FormHelper(this.form,this.options.naming,this.options.separator),this.prefix=this.options.prefix,this.$form=$(this.form),this.auto(this.options.auto)}function b(a,b){var c;return _.isArray(b)?(c=this.formHelper.createName(a,this.prefix,!0),this.$form.find('[name="'+c+'"]').length||(c=this.formHelper.createName(a,this.prefix))):c=this.formHelper.createName(a,this.prefix),c}function c(a,c){this.formHelper.setControlValue(b.call(this,a,c),null)}function d(a,b,e){var f=this;!_.isArray(a)&&_.isObject(a)?_.each(a,function(a,c){var g=_.clone(b);g.push(c),d.call(f,a,g,e)}):_.isUndefined(a)||(e===!0?c.call(this,b,a):this.bindAttribute(b))}function e(a){if(!this._silent){var b,c,e,f=DeepDiff.noConflict(),g=f.diff(a.previousAttributes(),a.attributes);if(g)for(b=0;b<g.length;++b)if("D"===g[b].kind)d.call(this,g[b].lhs,g[b].path,!0);else if("A"===g[b].kind)d.call(this,[],g[b].path);else{if(g[b].path.length>1)for(c=1,e=a.attributes[g[b].path[0]];!_.isUndefined(e)&&c<g[b].path.length-1;)e=e[g[b].path[c]],++c;_.isArray(e)?d.call(this,e,g[b].path.slice(0,g[b].path.length-1)):d.call(this,g[b].rhs,g[b].path)}}}a.prototype.bind=function(a){if(a=a||!1,this.trigger("bind:before"),a){var b,c=DeepDiff.noConflict(),e=c.diff(this.model.previousAttributes(),this.model.attributes);for(b=0;b<e.length;++b)"D"===e[b].kind&&d.call(this,e[b].lhs,e[b].path,!0)}d.call(this,this.model.attributes,[]),this.trigger("bind:after")},a.prototype.bindAttribute=function(a){var c,d,e;if(!_.isArray(a))throw new TypeError("Attribute must be Array");if(0===a.length)throw new TypeError("Attribute is empty!");for(d=this.model.get(a[0]),c=1;!_.isUndefined(d)&&c<a.length;)d=d[a[c]],++c;if(a.length!==c||(_.isUndefined(d)||_.isObject(d))&&!_.isArray(d))this.trigger("bind:attr:fail",a);else{e=b.call(this,a,d),this.trigger("bind:attr:before",a,e,d),this.silentRelated(!0);try{this.formHelper.setControlValue(e,d)}catch(f){throw this.silentRelated(!1),f}this.silentRelated(!1),this.trigger("bind:attr:after",a,e,d)}},a.prototype.getModel=function(){return this.model},a.prototype.getForm=function(){return this.form},a.prototype.getControleName=function(a,c){return b.call(this,a,c)},a.prototype.auto=function(a){if("boolean"!=typeof a)throw new TypeError("Auto must be boolean");a&&!this._auto?this.model.on("change",e,this):!a&&this._auto&&this.model.off("change",e),this._auto=a},a.prototype.isAuto=function(){return this._auto},a.prototype.getRelatedClass=function(){return Backbone.form.FormToModel},Backbone.form.ModelToForm=a}(),function(){"use strict";function a(a,b,c){this.formToModel=new Backbone.form.FormToModel(a,b,c),this.modelToForm=new Backbone.form.ModelToForm(a,b,c),this.formToModel.addRelated(this.modelToForm),this.auto(!(!_.isObject(c)||!_.isBoolean(c.auto))&&c.auto)}a.prototype.auto=function(a){this.formToModel.auto(a),this.modelToForm.auto(a)},a.prototype.isAuto=function(){return this.formToModel.isAuto()&&this.modelToForm.isAuto()},a.prototype.getFormToModel=function(){return this.formToModel},a.prototype.getModelToForm=function(){return this.modelToForm},Backbone.form.TwoWayBinding=a}(),function(){"use strict";Backbone.form.CollectionItemView=Backbone.View.extend({events:{"submit form":"_onFormSubmit"},initialize:function(a){if(!_.isObject(a))throw new TypeError("CollectionItemView: Options is required.");if(!_.isString(a.name))throw new TypeError("CollectionItemView: option name is not string.");this.backup=null,this.htmlAttr=a.htmlAttr||"_html",this.currentState=null,this.$el.addClass("form-collection__item"),this._initFormModel(a.formModel),this._templateRequest=!0,this._compiledTemplate=null,this.name=a.name,this.setPlaceholder(a.placeholder||"__name__"),this.setTemplate(a.template),a.editClick===!0&&this.$el.on("click",".form-collection__item_preview",$.proxy(this._onSwitchToForm,this)),a.editDblClick===!0&&this.$el.on("dblclick",".form-collection__item_preview",$.proxy(this._onSwitchToForm,this)),this.$el.on("click",".form-collection__btn-remove",$.proxy(this._onClickRemove,this)),this.$el.on("click",".form-collection__btn-edit",$.proxy(this._onClickEdit,this)),this.$el.on("click",".form-collection__btn-cancel",$.proxy(this._onClickCancel,this)),this.$el.on("click",".form-collection__btn-save",$.proxy(this._onClickSave,this)),this.listenTo(this.formModel,"destroy",this.destroyView),this.listenTo(this.formModel,"change",this.renderPreview),this.listenTo(this.formModel,"change",this._onFormModelChange)},renderParams:function(){return{name:this.name,form:this.formModel}},renderAll:function(){this.$el.html(this.getTemplate()(this.renderParams())),this.changeState(this.formModel.isNew()?"form":"preview")},renderPreview:function(){var a,b,c=this.getPreviewElement();c.length&&(a=$("<div />").html(this.getTemplate()(this.renderParams())),b=a.find("."+this.getPreviewElementClass()),b.attr("class",c.attr("class")),c.replaceWith(b))},btnUpdate:function(){var a=this.$el.find(".form-collection__btn-remove"),b=this.$el.find(".form-collection__btn-cancel");this.formModel.isNew()?(b.hide(),a.show()):(b.show(),"form"===this.currentState?a.hide():a.show())},disabled:function(a){a?this.$el.find(":input").attr("disabled","disabled"):this.$el.find(":input").removeAttr("disabled")},getTemplate:function(){return(null===this._compiledTemplate||this._templateRequest)&&(this._compiledTemplate=this._createTemplate(),this._templateRequest=!1),this._compiledTemplate},setPlaceholder:function(a){this._templateRequest=!0,this.placeholder=String(a)},setTemplate:function(a){if(!_.isString(a))throw new TypeError("CollectionItemView: Template is not string");this._templateRequest=!0,this.template=a},getElement:function(){return this.$el},getBinding:function(){return this.twoWayBinding},getValidation:function(){return this.validation},destroyView:function(a){a!==!0&&this.trigger("item:destroy",this),this.undelegateEvents(),this.remove()},getFormElement:function(){return this.$el.find(".form-collection__item_form")},getPreviewElement:function(){return this.$el.find("."+this.getPreviewElementClass())},getPreviewElementClass:function(){return"form-collection__item_preview"},changeState:function(a){var b=this.getFormElement(),c=this.getPreviewElement(),d="form-collection__item_form--disabled",e="form-collection__item_preview--disabled";switch(a){case"form":b.removeClass(d),c.addClass(e);break;case"preview":b.addClass(d),c.removeClass(e)}this.currentState=a,this.btnUpdate()},getCurrentState:function(){return this.currentState},loadHtml:function(){this.formModel.has(this.htmlAttr)&&(this.$el.html(this.formModel.get(this.htmlAttr)),this.formModel.unset(this.htmlAttr))},_createTemplate:function(){var a;return a=this.placeholder.length&&!_.isNull(this.name)?this.template.replace(new RegExp(this.placeholder,"g"),this.name):this.template,_.template(a)},_initFormModel:function(a){if(!(a instanceof Backbone.Model))throw new TypeError("Form model is not Backbone.Model.");this.formModel=a,this.validation=new Backbone.form.ValidationView({el:this.$el,model:this.formModel,autoBinding:!1}),this.twoWayBinding=this.validation.getBinding(),this.formToModel=this.twoWayBinding.getFormToModel(),
this.formToModel.setFileModel(new Backbone.Model),this.twoWayBinding.auto(!0)},_onClickRemove:function(a){function b(){c.disabled(!1)}a.stopPropagation();var c=this;this.disabled(!0),this.formModel.destroy({success:b,error:b}),this.trigger("item:click:remove",this)},_onClickSave:function(a){function b(){c.disabled(!1)}a.stopPropagation();var c=this;this.disabled(!0),this.backup=null,this.formModel.save({},{success:function(a,d){d[c.htmlAttr]||(b(),c.changeState("preview"))},error:b}),this.trigger("item:click:save",this)},_onClickEdit:function(a){a.stopPropagation(),this.backup=this.formModel.toJSON(),this.changeState("form"),this.trigger("item:click:edit",this)},_onClickCancel:function(a){a.stopPropagation(),_.isNull(this.backup)||this.formModel.set(this.backup),this.changeState("preview"),this.trigger("item:click:cancel",this)},_onFormSubmit:function(a){a.preventDefault()},_onFormModelChange:function(){this.formModel.has(this.htmlAttr)&&this.loadHtml()},_onSwitchToForm:function(){this.changeState("form"),this.trigger("item:swich_to_form",this)}})}(),function(){"use strict";Backbone.form.CollectionView=Backbone.View.extend({initialize:function(a){if(!_.isObject(a))throw new TypeError("CollectionView: Options is required.");if(a.itemView&&a.itemView instanceof Backbone.form.CollectionItemView?this.itemView=a.itemView:this.itemView=Backbone.form.CollectionItemView,this.items=[],this.index=0,this.htmlAttr=a.htmlAttr||"_html",this.closeAlert=a.closeAlert||null,this._onRuquestError=a.onRuquestError,this.setElContainer(a.elContainer),this.newElementPlace=a.newElementPlace||"last",this.prototypeAttr=a.prototypeAttr||"data-prototype",this.autofocus=a.autofocus||!0,this.editClick=a.editClick||!1,this.editDblClick=a.editDblClick||!1,a.itemTemplate)this.setItemTemplate(a.itemTemplate);else{if(!this.$el.get(0).hasAttribute(this.prototypeAttr))throw new Error("CollectionView: Please set itemTemplate.");this.setItemTemplate(this.$el.attr(this.prototypeAttr))}this._initFormCollection(a.formCollection),this._initFromElement(),this.$el.on("click",".form-collection__btn-add",$.proxy(this._onClickAdd,this)),this.$el.on("click",".form-collection__btn-save-all",$.proxy(this._onClickSaveAll,this)),this.$el.on("click",".form-collection__btn-remove-all",$.proxy(this._onClickRemoveAll,this)),this.listenTo(this.formCollection,"sync",this._onFormCollectionSync),this.listenTo(this.formCollection,"error",this._onRuquestError),this._initBeforeUnload(),this.disabled(!1)},clear:function(){this.items.forEach(function(a){a.destroyView(!0)}),this.items=[],this.index=0,this.trigger("items:clear",this)},addItem:function(a,b){var c,d,e=new this.formCollection.model;a&&e.set(e.idAttribute,a),this.formCollection.add(e),this._addModelListeners(e),d=this._itemViewCommonOptions(e),b?(d.el=b,c=new this.itemView(d),c.disabled(!1),c.getBinding().getFormToModel().bind()):(c=new this.itemView(d),c.renderAll(),c.disabled(!1),c.getBinding().getFormToModel().bind(),this._attachView(c)),this._addViewListeners(c),this.items.push(c),++this.index,this.trigger("items:add",this,c)},addItemWithModel:function(a){var b;this._addModelListeners(a),b=new this.itemView(this._itemViewCommonOptions(a)),a.has(this.htmlAttr)?b.loadHtml():(b.renderAll(),b.disabled(!1),b.getBinding().getModelToForm().bind()),this._attachView(b),this._addViewListeners(b),this.items.push(b),++this.index,this.trigger("items:add",this,b)},setItemTemplate:function(a){if(!_.isString(a))throw new TypeError("CollectionView: Item template is not string.");this.itemTemplate=a},setElContainer:function(a){var b;_.isString(a)?this.elContainer=this.$el.find(a):_.isObject(a)?this.elContainer=a:(b=this.$el.find(".form_collection__container"),this.elContainer=b.length?b:this.$el)},getItems:function(){return this.items},disabled:function(a){a?this.$el.find(":input").attr("disabled","disabled"):this.$el.find(":input").removeAttr("disabled")},_initFromElement:function(){var a=this;this.$el.find("[data-is-item]").each(function(){var b=$(this),c=b.attr("data-key");a.addItem(c,b)})},_initFormCollection:function(a){if(!(a instanceof Backbone.Collection))throw new TypeError("Form collection is not Backbone.Collection.");this.formCollection=a},_addModelListeners:function(a){var b=this;a.__addedItemListeners||(a.on("error",this._onRuquestError),a.on("change",function(){b.trigger("model:change",a)}),a.__addedItemListeners=!0)},_addViewListeners:function(a){var b=this;a.on("item:destroy",function(){b.items=_.reject(b.items,function(b){return b===a})})},_itemViewCommonOptions:function(a){return{template:this.itemTemplate,name:String(this.index),formModel:a,htmlAttr:this.htmlAttr,editClick:this.editClick,editDblClick:this.editDblClick}},_attachView:function(a){switch(this.newElementPlace){case"last":a.getElement().appendTo(this.elContainer);break;case"first":a.getElement().prependTo(this.elContainer);break;default:a.getElement().appendTo(this.elContainer)}this.autofocus&&a.getElement().find(":input:not(button)").eq(0).focus()},_onClickAdd:function(a){a.stopPropagation(),this.addItem(),this.trigger("items:click:add",this)},_onFormCollectionSync:function(a){var b=this;a instanceof Backbone.Collection&&(this.clear(),this.formCollection.models.forEach(function(a){b.addItemWithModel(a)}))},_onClickSaveAll:function(a){function b(){c.disabled(!1)}var c=this;a.stopPropagation(),this.disabled(!0),_.isFunction(this.formCollection.save)?(this.formCollection.save({success:b,error:b}),this.trigger("items:click:save_all",this)):(b(),this.trigger("items:error:save_all",this))},_onClickRemoveAll:function(a){a.stopPropagation(),this.clear(),_.isFunction(this.formCollection.destroy)?(this.formCollection.destroy(),this.trigger("items:click:remove_all",this)):(this.formCollection.reset(),this.formCollection.trigger("update",this.formCollection,this.options),this.trigger("items:error:remove_all",this))},_initBeforeUnload:function(){var a=this,b=this.closeAlert;_.isFunction(b)&&window.addEventListener("beforeunload",function(c){var d,e;if(e=_.find(a.getItems(),function(a){return"form"===a.getCurrentState()}),!_.isUndefined(e))return d=b(),(c||window.event).returnValue=d,d})}})}(),function(){"use strict";Backbone.form.ValidationView=Backbone.View.extend({events:{submit:"_onSubmit","click :input":"_onClickInput"},initialize:function(a){Backbone.Validation.bind(this,{model:this.model}),this.errorsPlace=a.errorsPlace||"after",this.bindingOptions=a.bindingOptions||{},this.binding=new Backbone.form.TwoWayBinding(this.model,this.$el,this.bindingOptions),this.validValue=0,this.validPercent=0,this.errors={},this.autoBinding=a.autoBinding||!0,this.classFormErrors="form__errors",this.classFormError="form__error form-control-feedback",this.classInputError="form-control-danger",this.classFormGroupError="has-danger",this.listenTo(this.model,"change",this._onModelChange),this.listenTo(this.model,"validated",this._onModelValidated),this.autoBinding&&this.binding.auto(!0)},bindToModel:function(){this.binding.formToModel.bind()},getBinding:function(){return this.binding},getValidPercent:function(){return this.validPercent},getErrors:function(){return this.errors},getErrorsContainer:function(a){var b;switch(this.errorsPlace){case"before":b=a.prev();break;case"after":b=a.next()}if(!b.hasClass(this.classFormErrors))switch(b=$("<div />").addClass(this.classFormErrors),this.errorsPlace){case"before":b.insertBefore(a);break;case"after":b.insertAfter(a)}return b},addError:function(a,b){var c=this.getErrorsContainer(a);b&&"__none"!==b&&$("<div />").addClass(this.classFormError).appendTo(c).text(b),a.attr("data-has-error","yes").addClass(this.classInputError).parent().addClass(this.classFormGroupError)},clearErrors:function(a){this.getErrorsContainer(a).empty(),this._removeErrorState(a)},clearAllErrors:function(){this.$el.find("."+this.classFormErrors).empty(),this._removeErrorState(this.getItemsWithErrors())},getItemsWithErrors:function(){return this.$el.find("[data-has-error]")},getFirstErrorInput:function(){return this.$el.find("[data-has-error]:input:eq(0)")},disabledHtmlValidation:function(a){"FORM"===this.$el.prop("tagName")&&(a?this.$el.attr("novalidate","novalidate"):this.$el.removeAttr("novalidate"))},_calculatePercent:function(a){var b=this.$el.find(':input:not([type="button"],[type="submit"],[type="image"],[type="reset"],[type="file"]):not(button)').length,c=b-_.keys(a).length;this.errors=a,this.validValue=c/b,this.validValue=isNaN(this.validValue)?0:this.validValue,this.validPercent=Math.round(100*this.validValue)},_removeErrorState:function(a){a.removeAttr("data-has-error").removeClass(this.classInputError).parent().removeClass(this.classFormGroupError)},_onModelChange:function(a){a.isValid(!0)},_onModelValidated:function(a,b,c){this._calculatePercent(c);var d=this,e=this.binding.getModelToForm();this.clearAllErrors(),_.mapObject(c,function(a,c){var f=b.get(c),g=d.$el.find('[name="'+e.getControleName([c],f)+'"]');g.length&&g.data("ready-to-validation")&&d.addError(g,a)})},_onSubmit:function(a){var b=this;this.$el.find(":input").data("ready-to-validation",!0),this.model.isValid(!0)||(a.preventDefault(),setTimeout(function(){b.getFirstErrorInput().focus()},50))},_onClickInput:function(a){$(a.target).data("ready-to-validation",!0),this.model.isValid(!0)}})}(),Backbone.form.setFormToModelDefaults(),Backbone.form.setModelToFormDefaults();