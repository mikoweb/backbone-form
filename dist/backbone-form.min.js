!function(a,b){"use strict";"function"==typeof define&&define.amd?define([],b):"object"==typeof exports?module.exports=b():a.DeepDiff=b()}(this,function(a){"use strict";function b(a,b){a.super_=b,a.prototype=Object.create(b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}})}function c(a,b){Object.defineProperty(this,"kind",{value:a,enumerable:!0}),b&&b.length&&Object.defineProperty(this,"path",{value:b,enumerable:!0})}function d(a,b,c){d.super_.call(this,"E",a),Object.defineProperty(this,"lhs",{value:b,enumerable:!0}),Object.defineProperty(this,"rhs",{value:c,enumerable:!0})}function e(a,b){e.super_.call(this,"N",a),Object.defineProperty(this,"rhs",{value:b,enumerable:!0})}function f(a,b){f.super_.call(this,"D",a),Object.defineProperty(this,"lhs",{value:b,enumerable:!0})}function g(a,b,c){g.super_.call(this,"A",a),Object.defineProperty(this,"index",{value:b,enumerable:!0}),Object.defineProperty(this,"item",{value:c,enumerable:!0})}function h(a,b,c){var d=a.slice((c||b)+1||a.length);return a.length=b<0?a.length+b:b,a.push.apply(a,d),a}function i(a){var b=typeof a;return"object"!==b?b:a===Math?"math":null===a?"null":Array.isArray(a)?"array":a instanceof Date?"date":/^\/.*\//.test(a.toString())?"regexp":"object"}function j(b,c,k,l,m,n,o){m=m||[];var p=m.slice(0);if("undefined"!=typeof n){if(l&&l(p,n,{lhs:b,rhs:c}))return;p.push(n)}var q=typeof b,r=typeof c;if("undefined"===q)"undefined"!==r&&k(new e(p,c));else if("undefined"===r)k(new f(p,b));else if(i(b)!==i(c))k(new d(p,b,c));else if(b instanceof Date&&c instanceof Date&&b-c!==0)k(new d(p,b,c));else if("object"===q&&null!==b&&null!==c){if(o=o||[],o.indexOf(b)<0){if(o.push(b),Array.isArray(b)){var s;b.length;for(s=0;s<b.length;s++)s>=c.length?k(new g(p,s,new f(a,b[s]))):j(b[s],c[s],k,l,p,s,o);for(;s<c.length;)k(new g(p,s,new e(a,c[s++])))}else{var t=Object.keys(b),u=Object.keys(c);t.forEach(function(d,e){var f=u.indexOf(d);f>=0?(j(b[d],c[d],k,l,p,d,o),u=h(u,f)):j(b[d],a,k,l,p,d,o)}),u.forEach(function(b){j(a,c[b],k,l,p,b,o)})}o.length=o.length-1}}else b!==c&&("number"===q&&isNaN(b)&&isNaN(c)||k(new d(p,b,c)))}function k(b,c,d,e){return e=e||[],j(b,c,function(a){a&&e.push(a)},d),e.length?e:a}function l(a,b,c){if(c.path&&c.path.length){var d,e=a[b],f=c.path.length-1;for(d=0;d<f;d++)e=e[c.path[d]];switch(c.kind){case"A":l(e[c.path[d]],c.index,c.item);break;case"D":delete e[c.path[d]];break;case"E":case"N":e[c.path[d]]=c.rhs}}else switch(c.kind){case"A":l(a[b],c.index,c.item);break;case"D":a=h(a,b);break;case"E":case"N":a[b]=c.rhs}return a}function m(a,b,c){if(a&&b&&c&&c.kind){for(var d=a,e=-1,f=c.path?c.path.length-1:0;++e<f;)"undefined"==typeof d[c.path[e]]&&(d[c.path[e]]="number"==typeof c.path[e]?[]:{}),d=d[c.path[e]];switch(c.kind){case"A":l(c.path?d[c.path[e]]:d,c.index,c.item);break;case"D":delete d[c.path[e]];break;case"E":case"N":d[c.path[e]]=c.rhs}}}function n(a,b,c){if(c.path&&c.path.length){var d,e=a[b],f=c.path.length-1;for(d=0;d<f;d++)e=e[c.path[d]];switch(c.kind){case"A":n(e[c.path[d]],c.index,c.item);break;case"D":e[c.path[d]]=c.lhs;break;case"E":e[c.path[d]]=c.lhs;break;case"N":delete e[c.path[d]]}}else switch(c.kind){case"A":n(a[b],c.index,c.item);break;case"D":a[b]=c.lhs;break;case"E":a[b]=c.lhs;break;case"N":a=h(a,b)}return a}function o(a,b,c){if(a&&b&&c&&c.kind){var d,e,f=a;for(e=c.path.length-1,d=0;d<e;d++)"undefined"==typeof f[c.path[d]]&&(f[c.path[d]]={}),f=f[c.path[d]];switch(c.kind){case"A":n(f[c.path[d]],c.index,c.item);break;case"D":f[c.path[d]]=c.lhs;break;case"E":f[c.path[d]]=c.lhs;break;case"N":delete f[c.path[d]]}}}function p(a,b,c){if(a&&b){var d=function(d){c&&!c(a,b,d)||m(a,b,d)};j(a,b,d)}}var q,r,s=[];return q="object"==typeof global&&global?global:"undefined"!=typeof window?window:{},r=q.DeepDiff,r&&s.push(function(){"undefined"!=typeof r&&q.DeepDiff===k&&(q.DeepDiff=r,r=a)}),b(d,c),b(e,c),b(f,c),b(g,c),Object.defineProperties(k,{diff:{value:k,enumerable:!0},observableDiff:{value:j,enumerable:!0},applyDiff:{value:p,enumerable:!0},applyChange:{value:m,enumerable:!0},revertChange:{value:o,enumerable:!0},isConflict:{value:function(){return"undefined"!=typeof r},enumerable:!0},noConflict:{value:function(){return s&&(s.forEach(function(a){a()}),s=null),k},enumerable:!0}}),k}),Backbone.form={},Backbone.form.mixin={},function(){"use strict";var a={},b={};Backbone.form.validModelForm=function(a,b){if(_.isUndefined(a))throw new TypeError("model is undefined");if(_.isUndefined(b))throw new TypeError("form is undefined");if(!(a instanceof Backbone.Model))throw new TypeError("expected Backbone.Model");if(b instanceof HTMLElement||!_.isFunction(b.get)||(b=b.get(0)),!(b instanceof HTMLElement))throw new TypeError("expected HTMLElement");return{model:a,form:b}},Backbone.form.getFormToModelDefaults=function(){return a},Backbone.form.setFormToModelDefaults=function(b){a=_.defaults(b||{},{naming:Backbone.form.FormHelper.MODES.brackets,separator:null,auto:!1,keepPrefix:!0})},Backbone.form.getModelToFormDefaults=function(){return b},Backbone.form.setModelToFormDefaults=function(a){b=_.defaults(a||{},{naming:Backbone.form.FormHelper.MODES.brackets,separator:null,auto:!1,prefix:null})}}(),function(){"use strict";function a(a){if(!(a instanceof this.getRelatedClass()))throw new TypeError("Unexpected related object")}var b={};b.getRelated=function(){return this._related},b.isRelatedWith=function(a){return _.contains(this._related,a)},b.addRelated=function(b){a.call(this,b),this.isRelatedWith(b)||(this._related.push(b),b.isRelatedWith(this)||b.addRelated(this))},b.removeRelated=function(b){a.call(this,b),this.isRelatedWith(b)&&(this._related=_.reject(this._related,function(a){return b===a}),b.isRelatedWith(this)&&b.removeRelated(this))},Backbone.form.mixin.related=b}(),function(){"use strict";var a={};a.silentRelated=function(a){var b,c=this.getRelated();if("boolean"!=typeof a)throw new TypeError("silent must be boolean");for(b=0;b<c.length;++b)c[b]._silent=a},Backbone.form.mixin.relatedSilent=a}(),function(){"use strict";function a(b,c,d){var e,f=!1;if(!(b instanceof HTMLElement))throw new TypeError("Expected HTMLElement");if(_.isUndefined(c))throw new TypeError("Expected mode");for(e in a.MODES)if(a.MODES.hasOwnProperty(e)&&c===a.MODES[e]){f=!0;break}if(!f)throw new TypeError("Unexpected mode");if(c===a.MODES.separator){if("string"!=typeof d)throw new TypeError("separator is not string");if(!d.length)throw new TypeError("separator is empty")}this.form=$(b),this.mode=c,this.separator=d}function b(a){return"[]"===a.substr(a.length-2)}function c(a){if(!_.isString(a))throw new TypeError("Name must be string");var b=this.form.find('[name="'+a+'"]'),c=b.eq(0),d=null,e=null,f=!1;return c.length&&(d=c.attr("type"),e=c.prop("tagName").toLowerCase(),f=c.is(":disabled")),{getControls:function(){return b},getControl:function(){return c},getType:function(){return d},getTagName:function(){return e},isDisabled:function(){return f}}}a.MODES={brackets:"brackets",separator:"separator"},Object.freeze&&Object.freeze(a.MODES),a.prototype.getInputCheckedValue=function(a){var b,c=[];if("string"==typeof a)b=this.form.find('[name="'+a+'"]:enabled');else{if(!_.isFunction(a.each))throw new Error("Unexpected value");b=a}return b.each(function(){var a=$(this);a.is(":checked")&&c.push(a.val())}),c},a.prototype.getControlValue=function(a){var b,d,e=c.call(this,a),f=e.getType();if(!e.isDisabled())switch(e.getTagName()){case"input":"radio"===f?(d=this.getInputCheckedValue(e.getControls()),b=d.length?d[d.length-1]:null):"checkbox"===f?(d=this.getInputCheckedValue(e.getControls()),b=1===d.length&&1===e.getControls().length?d[0]:d.length?d:null):"file"===f?(b=[],e.getControls().each(function(){var a,c,d=$(this),e=[];if(_.isUndefined(FileList))e.push(d.val());else for(c=d.get(0).files,a=0;a<c.length;++a)e.push(c[a].name);b.push({element:d.get(0),filename:e,files:c})})):b="button"!==f&&"submit"!==f&&"image"!==f&&"reset"!==f?e.getControl().val():null;break;case"select":var g=e.getControl().val();b=g&&g.length?g:null;break;case"textarea":b=e.getControl().val();break;case"button":b=null}return b},a.prototype.setControlValue=function(a,b){var d=c.call(this,a),e=d.getType();if(_.isObject(b)&&!_.isArray(b)||_.isFunction(b)||_.isUndefined(b))throw new TypeError("Unexpected value with name "+a);switch(!_.isBoolean(b)||"input"===d.getTagName()&&"checkbox"===e&&1===d.getControls().length||(b=""),d.getTagName()){case"input":"radio"===e?d.getControls().val(_.isArray(b)?b.length?[b[0]]:[]:[b]):"checkbox"===e?_.isBoolean(b)?d.getControl().prop("checked",b):d.getControls().val(_.isArray(b)?b:[b]):"button"!==e&&"submit"!==e&&"image"!==e&&"file"!==e&&"reset"!==e&&d.getControl().val(_.isArray(b)?b.length?b[0]:"":b);break;case"select":d.getControls().val(_.isArray(b)?b:[b]);break;case"textarea":d.getControl().val(_.isArray(b)?b.length?b[0]:"":b)}},a.prototype.getPrefix=function(c){var d=null,e=null;switch(b(c)&&(c=c.substr(0,c.length-2)),this.mode){case a.MODES.brackets:e=c.indexOf("["),e>0&&(d=c.substr(0,e));break;case a.MODES.separator:var f=c.split(this.separator,2);f.length>1&&(d=f[0])}return d},a.prototype.removePrefix=function(b){var c=this.getPrefix(b),d=b;return null!==c&&(d=b.substr(this.mode===a.MODES.separator?c.length+this.separator.length:c.length)),d},a.prototype.removeExtremeBrackets=function(a){return 0===a.indexOf("[")&&a.indexOf("]")===a.length-1?a.substr(1,a.length-2):a},a.prototype.getObjectFromName=function(c,d){var e,f={},g=this.getPrefix(c),h=f,i=null,j=null;if("string"!=typeof c)throw new TypeError("name is not string");if("boolean"!=typeof d)throw new TypeError("keepPrefix is not boolean");switch(e=this.getControlValue(c),b(c)&&(c=c.substr(0,c.length-2)),this.mode){case a.MODES.brackets:var k,l=/\[(.*?)\]/g;if(null!==g){for(d&&(h[g]={},h=h[g]);k=l.exec(c);)i=h,j=k[1],h[k[1]]={},h=h[k[1]];null!==i&&null!==j&&(i[j]=e)}else h[c]=e;break;case a.MODES.separator:c.split(this.separator).forEach(function(a,b,c){(d||!d&&0!==b||1===c.length)&&(i=h,j=a,h[a]={},h=h[a])}),null!==i&&null!==j&&(i[j]=e)}return f},a.prototype.getObjectPath=function(a){for(var b=[],c=_.keys(a),d=a;1===c.length&&_.isObject(d)&&!_.isArray(d);)d=d[c[0]],b.push(c[0]),c=_.keys(d);return _.isObject(d)&&!_.isArray(d)?[]:b},a.prototype.createName=function(b,c,d){var e,f;if(!_.isArray(b))throw new TypeError("Path must be Array");if(0===b.length)throw new Error("Path is empty!");if(!_.isUndefined(c)&&!_.isNull(c)){if("string"!=typeof c)throw new TypeError("Prefix must be string");if(0===c.length)throw new Error("Prefix must be longer than 0 characters")}switch(this.mode){case a.MODES.brackets:for(c?e=c+"["+b[0]+"]":b.length>0&&(e=b[0]),f=1;f<b.length;++f)e+="["+b[f]+"]";break;case a.MODES.separator:for(e=c?c+this.separator:"",f=0;f<b.length;++f)e+=b[f]+this.separator;e=e.substr(0,e.length-this.separator.length)}return d&&(e+="[]"),e},Backbone.form.FormHelper=a}(),function(){"use strict";function a(a,b,c){var d=Backbone.form.validModelForm(a,b);_.extend(this,Backbone.Events),delete this.bind,delete this.unbind,_.extend(this,Backbone.form.mixin.related),_.extend(this,Backbone.form.mixin.relatedSilent),this._related=[],this._auto=!1,this._silent=!1,this._toSynchronize={},this.model=d.model,this.form=d.form,this.options=_.defaults(c||{},Backbone.form.getFormToModelDefaults()),this.formHelper=new Backbone.form.FormHelper(this.form,this.options.naming,this.options.separator),this.$form=$(this.form),this.fileModel=null,this.auto(this.options.auto)}function b(a,c){var d;for(d in c)c.hasOwnProperty(d)&&(a[d]&&_.isObject(c[d])&&!_.isArray(c[d])?b(a[d],c[d]):null!==c[d]?a[d]=c[d]:a[d]&&null===c[d]&&delete a[d]);return a}function c(a){this._silent||a.currentTarget===this.getForm()||this.bindControl(a.currentTarget.getAttribute("name"))}function d(a){var b=this.formHelper.getObjectPath(a),c=!1;if(1===b.length)this.model.unset(b[0],{silent:!0}),c=!0;else if(b.length>1){var d,e,f,g=!0,h=b.length-1;if(d=this.model.get(b[0]),_.isObject(d)&&!_.isArray(d)){for(f=1;f<h&&g;)e=d,d=d[b[f]],_.isObject(d)&&!_.isArray(d)||(g=!1),++f;g&&(delete d[b[b.length-1]],e&&0===_.keys(d).length&&b.length-2>-1&&delete e[b[b.length-2]],0===_.keys(this.model.get(b[0])).length&&this.model.unset(b[0],{silent:!0}),c=!0)}}return c}function e(a,c,d,e){_.isNull(d)?a.unset(c):_.isObject(e)&&!_.isArray(e)&&_.isObject(d)&&!_.isArray(d)?a.set(c,b($.extend(!0,{},e),d)):_.isUndefined(e)&&_.isObject(d)&&!_.isArray(d)?a.set(c,b({},d)):a.set(c,d)}var f={selectable:'select, input[type="checkbox"], input[type="radio"]',inputable:'textarea, input:not([type="radio"],[type="checkbox"],[type="button"],[type="submit"],[type="image"],[type="reset"],[type="file"])'};Object.freeze&&Object.freeze(f),a.prototype.WildcardValueError=function(a){this.name="Backbone.form.FormToModel.WildcardValueError",this.message=a},a.prototype.WildcardValueError.prototype=new Error,a.prototype.bind=function(){var a,b=this.$form.find("[name]:enabled");for(this.trigger("bind:before",b),this.sync(),a=0;a<b.length;a++)this.bindControl(b.get(a).getAttribute("name"));this.trigger("bind:after",b)},a.prototype.bindControl=function(a){var b,c,d=this.formHelper.getObjectFromName(a,this.options.keepPrefix),f=_.keys(d),g=!0,h=this.$form.find('[name="'+a+'"]'),i=h.eq(0);if(f.length>1)throw new this.WildcardValueError('Control "'+a+'" has '+f.length+" values");if(f.length&&(b=f[0],void 0!==d[b])){this.trigger("bind:control:before",a,d),this.silentRelated(!0);try{"file"!==i.attr("type")?(c=this.model.get(b),e(this.model,b,d[b],c)):this.fileModel instanceof Backbone.Model&&(c=this.fileModel.get(b),e(this.fileModel,b,d[b],c),this.fileModel.trigger("change",this.fileModel,{}))}catch(j){throw this.silentRelated(!1),j}this.silentRelated(!1),g=!1,this._toSynchronize[a]={value:d,length:h.length},this.trigger("bind:control:after",a,d,c)}g&&this.trigger("bind:control:fail",a,d)},a.prototype.getModel=function(){return this.model},a.prototype.getForm=function(){return this.form},a.prototype.auto=function(a){if("boolean"!=typeof a)throw new TypeError("Auto must be boolean");a&&!this._auto?(this.$form.on("change",f.selectable,$.proxy(c,this)),this.$form.on("change",'input[type="file"]',$.proxy(c,this)),this.$form.on("change keyup paste input",f.inputable,$.proxy(c,this))):!a&&this._auto&&(this.$form.off("change",f.selectable,c),this.$form.off("change",'input[type="file"]',c),this.$form.off("change keyup paste input",f.inputable,c)),this._auto=a},a.prototype.isAuto=function(){return this._auto},a.prototype.sync=function(){var a,b,c,e=[];this.trigger("sync:before",this._toSynchronize);for(a in this._toSynchronize)this._toSynchronize.hasOwnProperty(a)&&(b=this.$form.find('[name="'+a+'"]'),0===b.length||b.is(":disabled")?d.call(this,this._toSynchronize[a].value)&&e.push(a):b.length!==this._toSynchronize[a].length&&this.bindControl(a));for(c=0;c<e.length;++c)delete this._toSynchronize[e[c]];this.trigger("sync:after",this._toSynchronize)},a.prototype.getRelatedClass=function(){return Backbone.form.ModelToForm},a.prototype.getFileModel=function(){return this.fileModel},a.prototype.setFileModel=function(a){if(!(a instanceof Backbone.Model))throw new TypeError("expected Backbone.Model");this.fileModel=a},Backbone.form.FormToModel=a}(),function(){"use strict";function a(a,b,c){var d=Backbone.form.validModelForm(a,b);_.extend(this,Backbone.Events),delete this.bind,delete this.unbind,_.extend(this,Backbone.form.mixin.related),_.extend(this,Backbone.form.mixin.relatedSilent),this._related=[],this._auto=!1,this._silent=!1,this.model=d.model,this.form=d.form,this.options=_.defaults(c||{},Backbone.form.getModelToFormDefaults()),this.formHelper=new Backbone.form.FormHelper(this.form,this.options.naming,this.options.separator),this.prefix=this.options.prefix,this.$form=$(this.form),this.auto(this.options.auto)}function b(a,b){var c;return _.isArray(b)?(c=this.formHelper.createName(a,this.prefix,!0),this.$form.find('[name="'+c+'"]').length||(c=this.formHelper.createName(a,this.prefix))):c=this.formHelper.createName(a,this.prefix),c}function c(a,c){this.formHelper.setControlValue(b.call(this,a,c),null)}function d(a,b,e){var f=this;!_.isArray(a)&&_.isObject(a)?_.each(a,function(a,c){var g=_.clone(b);g.push(c),d.call(f,a,g,e)}):_.isUndefined(a)||(e===!0?c.call(this,b,a):this.bindAttribute(b))}function e(a){if(!this._silent){var b,c,e,f=DeepDiff.noConflict(),g=f.diff(a.previousAttributes(),a.attributes);for(b=0;b<g.length;++b)if("D"===g[b].kind)d.call(this,g[b].lhs,g[b].path,!0);else if("A"===g[b].kind)d.call(this,[],g[b].path);else{if(g[b].path.length>1)for(c=1,e=a.attributes[g[b].path[0]];!_.isUndefined(e)&&c<g[b].path.length-1;)e=e[g[b].path[c]],++c;_.isArray(e)?d.call(this,e,g[b].path.slice(0,g[b].path.length-1)):d.call(this,g[b].rhs,g[b].path)}}}a.prototype.bind=function(a){if(a=a||!1,this.trigger("bind:before"),a){var b,c=DeepDiff.noConflict(),e=c.diff(this.model.previousAttributes(),this.model.attributes);for(b=0;b<e.length;++b)"D"===e[b].kind&&d.call(this,e[b].lhs,e[b].path,!0)}d.call(this,this.model.attributes,[]),this.trigger("bind:after")},a.prototype.bindAttribute=function(a){var c,d,e;if(!_.isArray(a))throw new TypeError("Attribute must be Array");if(0===a.length)throw new TypeError("Attribute is empty!");for(d=this.model.get(a[0]),c=1;!_.isUndefined(d)&&c<a.length;)d=d[a[c]],++c;if(a.length!==c||(_.isUndefined(d)||_.isObject(d))&&!_.isArray(d))this.trigger("bind:attr:fail",a);else{e=b.call(this,a,d),this.trigger("bind:attr:before",a,e,d),this.silentRelated(!0);try{this.formHelper.setControlValue(e,d)}catch(f){throw this.silentRelated(!1),f}this.silentRelated(!1),this.trigger("bind:attr:after",a,e,d)}},a.prototype.getModel=function(){return this.model},a.prototype.getForm=function(){return this.form},a.prototype.auto=function(a){if("boolean"!=typeof a)throw new TypeError("Auto must be boolean");a&&!this._auto?this.model.on("change",e,this):!a&&this._auto&&this.model.off("change",e),this._auto=a},a.prototype.isAuto=function(){return this._auto},a.prototype.getRelatedClass=function(){return Backbone.form.FormToModel},Backbone.form.ModelToForm=a}(),function(){"use strict";function a(a,b,c){this.formToModel=new Backbone.form.FormToModel(a,b,c),this.modelToForm=new Backbone.form.ModelToForm(a,b,c),this.formToModel.addRelated(this.modelToForm),this.auto(!(!_.isObject(c)||!_.isBoolean(c.auto))&&c.auto)}a.prototype.auto=function(a){this.formToModel.auto(a),this.modelToForm.auto(a)},a.prototype.isAuto=function(){return this.formToModel.isAuto()&&this.modelToForm.isAuto()},a.prototype.getFormToModel=function(){return this.formToModel},a.prototype.getModelToForm=function(){return this.modelToForm},Backbone.form.TwoWayBinding=a}(),function(){"use strict";Backbone.form.CollectionItemView=Backbone.View.extend({events:{"submit form":"_onFormSubmit"},initialize:function(a){if(!_.isObject(a))throw new TypeError("CollectionItemView: Options is required.");if(!_.isString(a.name))throw new TypeError("CollectionItemView: option name is not string.");this.$el.addClass("form-collection__item"),this._initFormModel(a.formModel),this._templateRequest=!0,this._compiledTemplate=null,this.name=a.name,this.setPlaceholder(a.placeholder||"__name__"),this.setTemplate(a.template),this.btnRemoveSelector=a.btnRemoveSelector||".form-collection__btn-remove",this.$el.on("click",this.btnRemoveSelector,$.proxy(this._onClickRemove,this)),this.listenTo(this.formModel,"destroy",this.destroyView),this.listenTo(this.formModel,"change",this.renderPreview)},renderParams:function(){return{name:this.name,form:this.formModel}},render:function(){this.$el.html(this.getTemplate()(this.renderParams())),this.changeState(this.formModel.isNew()?"form":"preview")},renderPreview:function(){var a,b,c=this.getPreviewElement();c.length&&(a=$("<div />").html(this.getTemplate()(this.renderParams())),b=a.find("."+this.getPreviewElementClass()),b.attr("class",c.attr("class")),c.replaceWith(b))},getTemplate:function(){return(null===this._compiledTemplate||this._templateRequest)&&(this._compiledTemplate=this._createTemplate(),this._templateRequest=!1),this._compiledTemplate},setPlaceholder:function(a){this._templateRequest=!0,this.placeholder=String(a)},setTemplate:function(a){if(!_.isString(a))throw new TypeError("CollectionItemView: Template is not string");this._templateRequest=!0,this.template=a},getElement:function(){return this.$el},bind:function(){this.formToModel&&this.formToModel.bind()},destroyView:function(){this.trigger("item:destroy",this),this.undelegateEvents(),this.remove()},getFormElement:function(){return this.$el.find(".form-collection__item_form")},getPreviewElement:function(){return this.$el.find("."+this.getPreviewElementClass())},getPreviewElementClass:function(){return"form-collection__item_preview"},changeState:function(a){var b=this.getFormElement(),c=this.getPreviewElement(),d="form-collection__item_form--disabled",e="form-collection__item_preview--disabled";switch(a){case"form":b.removeClass(d),c.addClass(e);break;case"preview":b.addClass(d),c.removeClass(e)}},_onClickRemove:function(){this.formModel.destroy()},_createTemplate:function(){var a;return a=this.placeholder.length&&!_.isNull(this.name)?this.template.replace(new RegExp(this.placeholder,"g"),this.name):this.template,_.template(a)},_initFormModel:function(a){if(!(a instanceof Backbone.Model))throw new TypeError("Form model is not Backbone.Model.");this.formModel=a,this.twoWayBinding=new Backbone.form.TwoWayBinding(this.formModel,this.$el),this.formToModel=this.twoWayBinding.getFormToModel(),this.formToModel.setFileModel(new Backbone.Model),this.twoWayBinding.auto(!0)},_onFormSubmit:function(a){a.preventDefault()}})}(),function(){"use strict";Backbone.form.CollectionView=Backbone.View.extend({initialize:function(a){if(!_.isObject(a))throw new TypeError("CollectionView: Options is required.");if(a.itemView&&a.itemView instanceof Backbone.form.CollectionItemView?this.itemView=a.itemView:this.itemView=Backbone.form.CollectionItemView,this.index=0,this.setElContainer(a.elContainer),this.newElementPlace=a.newElementPlace||"last",this.prototypeAttr=a.prototypeAttr||"data-prototype",a.itemTemplate)this.setItemTemplate(a.itemTemplate);else{if(!this.$el.get(0).hasAttribute(this.prototypeAttr))throw new Error("CollectionView: Please set itemTemplate.");this.setItemTemplate(this.$el.attr(this.prototypeAttr))}this.autofocus=a.autofocus||!0,this._initFormCollection(a.formCollection),this._initFromElement(),this.btnAddSelector=a.btnAddSelector||".form-collection__btn-add",this.$el.on("click",this.btnAddSelector,$.proxy(this._onClickAdd,this))},addItem:function(a,b){var c,d,e=this,f=new this.formCollection.model;if(a&&f.set(f.idAttribute,a),this.formCollection.add(f),f.on("change",function(){e.trigger("model:change",f,c)}),d={template:this.itemTemplate,name:String(this.index),formModel:f},b)d.el=b,c=new this.itemView(d),c.bind();else{switch(c=new this.itemView(d),c.render(),c.bind(),this.newElementPlace){case"last":c.getElement().appendTo(this.elContainer);break;case"first":c.getElement().prependTo(this.elContainer);break;default:c.getElement().appendTo(this.elContainer)}this.autofocus&&c.getElement().find(":input").eq(0).focus()}++this.index},setItemTemplate:function(a){if(!_.isString(a))throw new TypeError("CollectionView: Item template is not string.");this.itemTemplate=a},setElContainer:function(a){var b;_.isString(a)?this.elContainer=this.$el.find(a):_.isObject(a)?this.elContainer=a:(b=this.$el.find(".form_collection__container"),this.elContainer=b.length?b:this.$el)},_initFromElement:function(){var a=this;this.$el.find("[data-is-item]").each(function(){var b=$(this),c=b.attr("data-key");a.addItem(c,b)})},_initFormCollection:function(a){if(!(a instanceof Backbone.Collection))throw new TypeError("Form collection is not Backbone.Collection.");this.formCollection=a},_onClickAdd:function(){this.addItem()}})}(),Backbone.form.setFormToModelDefaults(),Backbone.form.setModelToFormDefaults();